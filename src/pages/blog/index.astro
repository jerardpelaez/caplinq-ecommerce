---
import PageLayout from '../../layouts/PageLayout.astro';
import BlogCard from '../../components/content/BlogCard.astro';
import { getCollection } from 'astro:content';

// Fetch all published blog posts, sorted by date descending
const allPosts = await getCollection('blog', ({ data }) => !data.draft);
const posts = allPosts.sort(
  (a, b) => b.data.publishDate.getTime() - a.data.publishDate.getTime()
);

// Extract unique categories
const categories = [...new Set(posts.map((post) => post.data.category))].sort();

const pageTitle = 'Technical Blog - Specialty Chemicals Insights';
const pageDescription =
  'Expert insights on specialty chemicals, electronic materials, and semiconductor packaging from the CAPLINQ engineering team.';

const jsonLd = {
  '@context': 'https://schema.org',
  '@type': 'CollectionPage',
  name: 'CAPLINQ Technical Blog',
  description: pageDescription,
  url: 'https://www.caplinq.com/blog/',
  publisher: {
    '@type': 'Organization',
    name: 'CAPLINQ',
    url: 'https://www.caplinq.com',
  },
};
---

<PageLayout title={pageTitle} description={pageDescription} jsonLd={jsonLd}>
  <!-- Breadcrumbs -->
  <nav class="bg-gray-50 border-b border-gray-200" aria-label="Breadcrumb">
    <div class="container-site py-3">
      <ol class="flex items-center gap-2 text-sm text-gray-500">
        <li><a href="/" class="hover:text-primary-600 transition-colors">Home</a></li>
        <li class="flex items-center gap-2">
          <svg class="h-4 w-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
          </svg>
          <span class="text-gray-900 font-medium">Blog</span>
        </li>
      </ol>
    </div>
  </nav>

  <!-- Page header -->
  <section class="bg-gradient-to-br from-navy-900 to-primary-800 text-white">
    <div class="container-site py-12 lg:py-16">
      <h1 class="text-3xl lg:text-4xl font-bold leading-tight mb-4">{pageTitle}</h1>
      <p class="text-lg text-primary-100 max-w-3xl leading-relaxed">
        Expert insights on specialty chemicals, electronic materials, and semiconductor packaging.
        Technical guides, industry analysis, and application best practices from our engineering team.
      </p>
    </div>
  </section>

  <!-- Category tabs -->
  <div class="border-b border-gray-200 bg-white sticky top-[73px] z-30">
    <div class="container-site">
      <nav class="flex items-center gap-1 overflow-x-auto -mb-px" aria-label="Blog categories">
        <a
          href="/blog"
          class="px-4 py-3 text-sm font-medium border-b-2 border-primary-600 text-primary-600 whitespace-nowrap"
        >
          All
        </a>
        {categories.map((cat) => (
          <span
            class="px-4 py-3 text-sm font-medium text-gray-500 hover:text-gray-700 border-b-2 border-transparent hover:border-gray-300 transition-colors whitespace-nowrap cursor-pointer"
          >
            {cat}
          </span>
        ))}
      </nav>
    </div>
  </div>

  <!-- Blog posts grid -->
  <section class="py-12 lg:py-16">
    <div class="container-site">
      {posts.length > 0 ? (
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {posts.map((post) => (
            <BlogCard
              title={post.data.title}
              slug={post.data.slug}
              author={post.data.author}
              publishDate={post.data.publishDate}
              category={post.data.category}
              excerpt={post.data.excerpt}
              featuredImage={post.data.featuredImage}
            />
          ))}
        </div>
      ) : (
        <div class="text-center py-16">
          <p class="text-gray-500 text-lg">No blog posts available yet. Check back soon.</p>
        </div>
      )}
    </div>
  </section>
</PageLayout>
